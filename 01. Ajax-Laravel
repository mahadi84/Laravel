DATE: 20-Sept-2023

Ajax-Laravel:
---------------

00. Common syntax for JQUERY and AJAX 
    ex: a) Click to respond to specific div/id/class, 
        b) Prevent page load, 
    ***c) Get form data and Serialize it and add extra data and check those data, 
        d) show data through ID/Class with append function
        e) Reset form data,
        f) Success and Error function to show data
        g) For loop to show multiple error message

(04)01. How to get data from the database and show it in the input field with JSON? Ex: Show the Salary of an employee. 
(03)02. How do INSERT data into the table showing the validation message? Ex: While Website Contact Form data submission.
(08)03. How to UPDATE an Active/Inactive SWITCH-INDICATOR? Ex: To show/stop showing a menu/Employee/User etc.
(07)04. How to DELETE data with sweetalert2 and Ajax? Ex: Action button where All data shows 



05: How to check if the Email is a duplicate in the db table? Ex: Check whether email already exists before registration.
06. How to preview an image before inserting it in html form?
07. How to select Multiple checkboxes in one click? Ex: Provide Spatie permission

08. How to validate form data with jquery?



=========================== 00. Common syntax for JQUERY and AJAX; ===============================
var name = $("input[name=name]").val();
 if(name.length > 2){ }

type="text/javascript"
$(document).ready(function(){ });
$("#submit_form").click(function(e){  });
$.ajax({ });
e.preventDefault();
success:function(response){};
error:function(xhr){};
$.each(xhr.responseJSON.errors, function(key,value) { });
OR
for (var i = 0; i < outputfromserver.length; i++) {  alert outputfromserver[0];  }

var name = $("input[name=name]").val();
type : '', data:'', url: ''
$('#error-message').html('');
$('#showEmail').val();
$('#success-message').append('<div class="alert alert-success">'+response.message+'</div');
$("#contact_form")[0].reset();

***C) Get form data and Serialize it and add extra data and check those data?
Test here:https://www.w3schools.com/jquery/tryit.asp?filename=tryjquery_ajax_serialize
        $("#form_submit").click(function(){
            var data = $("#MyForm").serialize()+'&_token: "{{csrf_token()}}"';
            alert (data);
            OR
            $.ajax({
            url: '',
            type: 'post',
            data = $("#MyForm").serialize()+'&_token: "{{csrf_token()}}"',
            );
        });


============================ 01. How to get/SHOW data from the database into the input field?============================

ROUTE:------- 
Route::get('Order-show-due/{id}', 'Order_Show_Due');

Controller:------------
public function Order_Show_Due($id){
        $data['title'] = 'Order';
        $order = $this->OrderModel->find($id);
         if ($salary) {
             return response()->json(['order' => $order]);            
        }else{
             return response()->json(['message' => 'No Salary Found']);
        }
}

BLADE:------- 
<button  onclick="orderDue('{{$pen->id}}')" type="button" > <i class="fas fa-check"></i> </button>
<input name="order_id" id="order_id"  type="text">
<input name="total" id="total"  type="text">

<div id="error-message"> </div>

SCRIPT:-----
@section('script')
<script type="text/javascript">   
    function orderDue(id){
        $.ajax({
            type : "GET",
            url:"{{ url('Order-show-due')}}/"+id,
            dataType: "json",
               success: function(response) {
                    if (response.order) {              
                        $('#order_id').val(response.order.order_id);
                        $('#total').val(response.order.total);
                    }else{
                        $('#error-message').val(response.message);
                    }
              },
            });
    };
</script>
@endsection   


======================= 02. How to insert data into the table showing the validation message? =================================
WEBSITE: https://www.teknowize.com/articles/web-articles/laravel-ajax-crud-operation

CONTROLLER FUNCTION:--------
   function employee_add(Request $request){
         $request->validate([
                        'name' => 'required|min:2',
                        'message' => 'required|min:10'                     
                    ]);

    $contact_form= $this->contact_formModel;
        $contact_form->name    = trim($request->name);
        $contact_form->message = trim($request->message);

        if($contact_form->save()){
            $response = [
                'status'=>'ok',
                'success'=>true,
                'message'=>'Thanks! We will get back to you.'
            ];
            return $response;
        }else{
            $response = [
                'status'=>'ok',
                'success'=>false,
                'message'=>'Error .!! Record created failed!'
            ];
            return $response;
        }
    } 

BLADE:------

<span id="success-message"></span>
<span id="error-message"></span>
            <form id="contact_form" class='php-email-form'>          
              <div class="row">
                <div class="col-md-6 form-group">
                  <input type="text" name="name" class="form-control" placeholder="Your Name">
                </div>
              <div class="form-group mt-3">
                <textarea class="form-control" name="message" rows="5" placeholder="Message"></textarea>
              </div>        
             
              <div class="text-center"><button id="submit_form" type="submit">Send Message</button></div>
            </form>


SCRIPT:-----
<script type="text/javascript">   
$("#submit_form").click(function(e){
        e.preventDefault();

        var name = $("input[name=name]").val(); 
        var message = $("textarea[name=message]").val();
// alert (message);

        $.ajax({
          type : "POST",
          data : {
            name: name,
            message: message,
            _token: "{{csrf_token()}}"
          },
          url  : "{{ url('page/contact_form-add-post') }}",
          
          success: function(response) {
           $('#error-message').html('');
           $('#success-message').append('<div class="alert alert-success">'+response.message+'</div');
           // $('#success-message').html(response.message);
           $("#contact_form")[0].reset();
          },
          error: function (xhr) {
           $('#success-message').html('');
           $('#error-message').html('');
           $.each(xhr.responseJSON.errors, function(key,value) {
           $('#error-message').append('<div class="text-center text-danger">'+value+'</div');
          }); 
          },                    
    });
     
});

</script>


================================ 03. How to create an Active/Inactive SWITCH-INDICATOR? ==========================================
BLADE:-----
    <label class="custom-switch mt-2">
        <input type="checkbox" {{ ($query->status == '1') ? 'checked' ? ''}} name="custom-switch-checkbox" data-id="'.$query->id.'" class="custom-switch-input change-status">
        <span class="custom-switch-indicator"></span>           
    </label>
            
SCRIPT:-------------
    <script>
    $(document).ready(function(){       
            $('body').on('click', '.change-status', function(){
                let id = $(this).data('id');
                let isChecked = $(this).is(':checked');
                $.ajax({
                  url: "{{route('admin.category.change-status')}}",
                  method: 'PUT',
                  data: {
                    id: id,
                    status: isChecked
                  },
                  success: function(data){
                    toastr.success(data.message);
                  },
                  error: function(xhr, status, error){
                    toastr.error(data.message);
                    console.log(error);
                  }
                })          
            })
          });
    </script>

ROUTE:---
    Route::put('product-change-status', [ProductController::class, 'changeStatus'])->name('product.change-status');

CONTROLLER:----
    public function changeStatus(Request $request){
        $category= $this->categoryModel->findOrFail($request->id);
        $category->status= $request->status == 'true' ? 1: 0;
        if ($category->save()) {
            return response(['status'=> 'success', 'message' => 'Active Successfully']); 
         }else{
            return response(['status'=> 'error', 'message' => 'Faild...!']);  
        }  
    }


=========================== 04. How to delete data with sweetalert2 and ajax?  ===============================
SWITALERT2-TUTORIAL: https://sweetalert2.github.io/#examples

CDN: 
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

BLADE:
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <a href="{{route('admin.slider.destroy', $slider->id)}}"  class="delete-item"> Delete </a>

SCRIPT:-----
    <script>
    $(document).ready(function(){
        $.ajaxSetup({
            headers: { 'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')  }
        });

        $('body').on('click', '.delete-item', function(event){
            event.preventDefault();

            let deleteUrl = $(this).attr('href');

            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {                   
                        $.ajax({
                            type: 'DELETE',
                            url: deleteUrl,
                            success: function(data){
                                if(data.status == 'success'){
                                    Swal.fire( 'Deleted!', data.message, 'success')
                                    window.location.reload();
                                }else if (data.status == 'error'){
                                    Swal.fire('Cant Delete', data.message, 'error' )
                                }
                            },
                            error: function(xhr, status, error){
                                console.log(error);
                            }
                        })
                    }
            })
        })
    })
  </script>


ROUTE:
    Route::delete('product-image-destroy/{id}', [ProductImageGalleryController::class, 'destroy'])->name('product-image-destroy');
    OR
    Route::resource('product', ProductVariantController::class); ***For resource Route: 

CONTROLLER:----
     public function destroy(string $id){
        $Slider = $this->SliderModel->find($id);
            if (!empty($Slider->image) && file_exists('uploads/slider_images/'.$Slider->image)) {
                unlink('uploads/slider_images/'.$Slider->image);
             } 
                if($Slider->delete()){
                    return response(['status'=> 'success', 'message' => 'Deleted Successfully']); 
                }else {
                    return response(['status'=> 'error', 'message' => 'Faild !! Something went wrong.']);
                } 
     }



































==============================01_Ans: How to check if the Email is a duplicate in the db table?================
CONTROLLER FUNCTION:------
public function CheckEmail(Request $request){
        $email= $request->email;
        $isExists= $this->model->where('email', $email)->first();
        if ($isExists) {
            return response()->json(array("exists" => true));
        } else {
            return response()->json(array("exists" => false));
        }
}

HTML:--------
<form action='' methode='POST'>
<div class="input-group mb-3">
          <input name="email" type="email" value="{{ old('email')}}" class="form-control" placeholder="Email" onblur="duplicateEmail(this)">
          <div class="input-group-append">
            <div class="input-group-text">
              <span class="fas fa-envelope"></span>
            </div>            
          </div>
          <span class="input-group text-danger" id="duplicate_message"> {{$errors->first('email') }}</span>
        </div>
</form>


SCRIPT:-------
<script type="text/javascript">
function duplicateEmail(element) {
  var email= $(element).val();
  // alert(email);
  $.ajax({
    type :"POST",
    url:'{{url('checkemail')}}',
    data : {
      email: email,
      _token: "{{csrf_token()}}"
    },
    dataType: "json",
    success: function (res) {
      if (res.exists) {
        $('#duplicate_message').html("This email is already registered.");
      } else {
         $('#duplicate_message').html("");
      }
    },
      error:function(jqXHR, exception){
      }
  });
}
</script>

======================= 02._Ans: How to preview an image before inserting it in html form? =================================
BLADE:-----
<input name="image" type="file" class="form-control"   id="image">
<image id="show_image"  class="rounded avater-lg" src="{{ url('public/upload/default_image.jpg') }}" style="width: 80px; height: 80px;"  alt="Profile Image"> 


SCRIPT:-----
@section('script')
<script type="text/javascript">   
   $(document).ready(function(){
        $('#image').change(function(e){
            var reader = new FileReader();
            reader.onload = function(e){
                $('#show_image').attr('src', e.target.result);
            }
            reader.readAsDataURL(e.target.files['0']);
        });
    });      
</script>
@endsection   

======================= 03. How to insert data into the table showing the validation message? =================================
WEBSITE: https://www.teknowize.com/articles/web-articles/laravel-ajax-crud-operation

CONTROLLER FUNCTION:--------
   function employee_add(Request $request){
         $request->validate([
                        'name' => 'required|min:2',
                        'message' => 'required|min:10'                     
                    ]);

    $contact_form= $this->contact_formModel;
        $contact_form->name    = trim($request->name);
        $contact_form->message = trim($request->message);

        if($contact_form->save()){
            $response = [
                'status'=>'ok',
                'success'=>true,
                'message'=>'Thanks! We will get back to you.'
            ];
            return $response;
        }else{
            $response = [
                'status'=>'ok',
                'success'=>false,
                'message'=>'Error .!! Record created failed!'
            ];
            return $response;
        }
    } 

BLADE:------

<span id="success-message"></span>
<span id="error-message"></span>
            <form id="contact_form" class='php-email-form'>          
              <div class="row">
                <div class="col-md-6 form-group">
                  <input type="text" name="name" class="form-control" placeholder="Your Name">
                </div>
              <div class="form-group mt-3">
                <textarea class="form-control" name="message" rows="5" placeholder="Message"></textarea>
              </div>        
             
              <div class="text-center"><button id="submit_form" type="submit">Send Message</button></div>
            </form>


SCRIPT:-----
<script type="text/javascript">   
$("#submit_form").click(function(e){
        e.preventDefault();

        var name = $("input[name=name]").val(); 
        var message = $("textarea[name=message]").val();
// alert (message);

        $.ajax({
          type : "POST",
          data : {
            name: name,
            message: message,
            _token: "{{csrf_token()}}"
          },
          url  : "{{ url('page/contact_form-add-post') }}",
          
          success: function(response) {
           $('#error-message').html('');
           $('#success-message').append('<div class="alert alert-success">'+response.message+'</div');
           // $('#success-message').html(response.message);
           $("#contact_form")[0].reset();
          },
          error: function (xhr) {
           $('#success-message').html('');
           $('#error-message').html('');
           $.each(xhr.responseJSON.errors, function(key,value) {
           $('#error-message').append('<div class="text-center text-danger">'+value+'</div');
          }); 
          },                    
    });
     
});

</script>


============================ 04. How to get data from the database and show it in the input field?============================

ROUTE:------- 
Route::get('Order-show-due/{id}', 'Order_Show_Due');

Controller:------------
public function Order_Show_Due($id){
        $data['title'] = 'Order';
        $order = $this->OrderModel->find($id);
         if ($salary) {
             return response()->json(['order' => $order]);            
        }else{
             return response()->json(['message' => 'No Salary Found']);
        }
}

BLADE:------- 
<button  onclick="orderDue('{{$pen->id}}')" type="button" > <i class="fas fa-check"></i> </button>
<input name="order_id" id="order_id"  type="text">
<input name="total" id="total"  type="text">

<div id="error-message"> </div>

SCRIPT:-----
@section('script')
<script type="text/javascript">   
    function orderDue(id){
        $.ajax({
            type : "GET",
            url:"{{ url('Order-show-due')}}/"+id,
            dataType: "json",
               success: function(response) {
                    if (response.order) {              
                        $('#order_id').val(response.order.order_id);
                        $('#total').val(response.order.total);
                    }else{
                        $('#error-message').val(response.message);
                    }
              },
            });
    };
</script>
@endsection   


======================================05. Select Multiple checkboxes ===================================
@foreach()
<input name="permission_id[]" value="{{$p_nam->id}}" class="form-check-input" type="checkbox" id="formCheck{{ $p_nam->id}}" >
endforeach

<script type="text/javascript">
    $('#formCheckAll').click(function(){
        if ($(this).is(':checked')) {
            $('input[type=checkbox]').prop('checked',true);
        } else {
            $('input[type=checkbox]').prop('checked',false);
        }
    });
</script>


=================================== 06. How to validate form data with jquery? ===================================
SCRIPT:---

$(document).ready(function(){
    $('#myForm').validate({
    rules: {
      designation: {
        required: true,
      },
    },

    messages :{
      designation:{
        required: 'Please Enter designation',
      },  
    }, I

        errorElement: 'span',
        errorPlacement: function (error, element) {
          error.addClass('invalid-feedback');
          element.closest('.desig').append(error);   //.desig is input field class name
        },

        highlight function (element, errorClass, validClass){ 
          $(element).addClass('is-invalid');
        },
        unhighlight : function (element, errorClass, validClass){ 
          $(element).removeClass('is-invalid');
        },
    });
});

